{% load custom-filters %}
<script id="js-order-banner" type="text/javascript">
        {% if hash == "#first" %} // remove if django variable hash is defined first
        document.querySelector('#order-banner-td').parentElement.firstElementChild.remove()
        {% endif %}

        (document.location.hash == '#first') ? document.querySelector('#order-banner-td').parentElement.firstElementChild.remove() :""; // remove if there is the ash in the address
</script>
 <a id=url2 href="{% url 'order' %}"></a> <!-- URL variable for change -->
<style>
.wrapper-order {
    border: 0.75px solid {% if user.order_tommorow_done %}#4FB98E{% else %}#BC2D19{% endif %};
}
</style>
<div id="wrapper-order" class="wrapper-order">
    <div class="cal-ico">
        <svg viewBox="0 0 46 46" fill="none" xmlns="http://www.w3.org/2000/svg">
        <text id="cal-month" x="16.5" y="18" fill="{% if user.order_tommorow_done %}#4FB98E{% else %}#BC2D19{% endif %}">May</text>
        <text id="cal-day" x="10" y="38" fill="{% if user.order_tommorow_done %}#4FB98E{% else %}#BC2D19{% endif %}">12</text>
        <path x="13" y="70" d="M29.3524 4.4878H16.9214V6.17073H29.3524V4.4878ZM41.3452 4.4878H34.2262V6.17073H41.3452C42.9881 6.17073 44.3571 7.57317 44.3571 9.2561V35.9024H40.7429C38.169 35.9024 36.0881 38.0341 36.0881 40.6707V44.3171H4.65476C3.0119 44.3171 1.64286 42.9146 1.64286 41.2317V9.2561C1.64286 7.57317 3.0119 6.17073 4.65476 6.17073H12.0476V4.4878H4.65476C2.08095 4.4878 0 6.61951 0 9.2561V41.2317C0 43.8683 2.08095 46 4.65476 46H37.731L37.7857 45.9439L45.781 37.8659L46 37.6415V9.2561C46 6.61951 43.919 4.4878 41.3452 4.4878ZM37.731 43.5878V40.6707C37.731 38.9878 39.1 37.5854 40.7429 37.5854H43.7L37.731 43.5878ZM14.4571 10.7707C14.8952 10.7707 15.2786 10.378 15.2786 9.92927V0.841463C15.2786 0.392683 14.8952 0 14.4571 0C14.019 0 13.6357 0.392683 13.6357 0.841463V9.92927C13.6357 10.4341 14.019 10.7707 14.4571 10.7707ZM31.8167 10.7707C32.2548 10.7707 32.6381 10.378 32.6381 9.92927V0.841463C32.6381 0.392683 32.2548 0 31.8167 0C31.3786 0 30.9952 0.392683 30.9952 0.841463V9.92927C30.9952 10.4341 31.3238 10.7707 31.8167 10.7707Z" fill="{% if user.order_tommorow_done %}#4FB98E{% else %}#BC2D19{% endif %}"/>
        </svg>
    </div>
    {% if user.order_tommorow_done %}
    <div id="ban-title">NEXT-DAY ORDER <small>({{ 1|addDays|date:"l" }})</small></div>
    {% else %}
    <div id="ban-title">SELECT YOUR FAVORITE PRODUCTS</div>
    {% endif %}
    <div id="text-order"></div>
    <div id="text-order2" class="hide-order">Free delivery {{user.order_tommorow_done.customer.preference|capfirst}}</div>
    <div id="total-order-container" class="hide-order">
        <span class="total-detail-hide" id="total-order"></span><br>
        <span class="total-detail-hide"> &nbsp;&nbsp;&nbsp;- {{user.membership.name|capfirst}} advantage : -<span id="discounted"></span></span><br>
        <span><b id="total-TBP"></b></span>

    </div>
    <div class="check-order-group">
        <button id="reset" class="hide-order hide-reset">reset</button>
        {% if user.order_tommorow_done %}
        <div id="text-confirm-order" class="hide-order">Modify you Order? <i class="fas fa-arrow-right"></i></div>
        {% else %}
        <div id="text-confirm-order" class="hide-order">Confirm your Order</div>
        {% endif %}
        <div id="check-order" class="hide-order">
            {% if user.order_tommorow_done %}
            <form action="{% url 'modify' %}" method="POST" onclick="let c=confirm('This will cancel your order and topup your account balance. Confirm?'); c ? submit() : ''">
            {% else %}
            <form action="{% url 'confirm' %}" method="POST" onclick=submit()>
            {% endif %}
            {% csrf_token %}
                <div class="spinner-border text-success checkBox-load" role="status" style="height: 2.3vw; width: 2.3vw;">
                <span class="sr-only">Loading...</span>
                </div>
                <svg viewBox="0 0 69 69" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path id="checked" class="checkBox-hide" d="M18.3662 27.4722L13 32.6828L30.25 49.4328L49.4166 30.8217L68.5833 12.2106L63.2171 7L30.25 38.8241L18.3662 27.4722Z" fill="#4FB98E"/>
                    <path d="M61.3333 60.6762H7.66673V7.58459H46V0H7.66673C3.44964 0 0 3.41268 0 7.58459V60.6762C0 64.8481 3.44964 68.2608 7.66673 68.2608H61.3333C65.5504 68.2608 69 64.8481 69 60.6762V30.3382H61.3333V60.6762Z" fill="#112F41"/>
                </svg>
                <input type="hidden" id="page" name="page" value="order" />
            </form>
        </div>
    </div>
</div>

<script id="js-order-banner" type="text/javascript">
    {% if not user.membership %}
    hide(".total-detail-hide"); // hide total detail
    {% endif %}
    {% if user.order_tommorow_done %} // if order done
document.addEventListener('DOMContentLoaded', () => {
    document.querySelector("#checked").style.visibility = 'visible'; //show checked
    document.querySelector("#total-TBP").innerHTML = "<span>" +{{ user.order_tommorow_done.total }} + " AED paid / Order Confirmed</span>";
    hide(".hide-reset"); // hide reset
    hide(".total-detail-hide"); // hide total detail
})
    {% else %} // if order not done
document.addEventListener('DOMContentLoaded', () => {
    if (document.querySelector(".checkBox-load").style.visibility !== 'hidden'){ //if load activated
        updateDate(); //update date
        document.querySelector("#check-order").children[0].action = document.querySelector("#url2").href; // change link back to order (in meta)

        if (localStorage.getItem('order') !== undefined){ // if item already saved
            let savedOrder = JSON.parse(localStorage.getItem('order')); // get the saved order
            for (let i = 0; i<savedOrder.items.length; i++){
                window[savedOrder.items[i].name] = new Item(savedOrder.items[i].type, savedOrder.items[i].name, savedOrder.items[i].price, savedOrder.items[i].qty); // load items
            }
            order.default=savedOrder.default
        }
        updateOrderHTML();
        const balance = getBalance();

        hide(".hide-reset"); //hide reset button
        document.querySelector("#text-confirm-order").innerHTML = "Update your order?";
        let checkBox= document.querySelector("#check-order"); // get checkbox
        document.querySelector("#ban-title").innerHTML = "CONFIRM AND PAY";
    }
    else {
        let checkBox= document.querySelector("#check-order"); // get checkbox
        checkBox.onclick = () =>{ // onclick checkbox
        (document.getElementById('DO-check').checked) ? order.default=true : order.default=false
        saveItemOrder();
        unhide(".checkBox-load");
        }
    }

})
    {% endif %}
</script>
